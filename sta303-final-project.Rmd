---
title: "Report title"
subtitle: "Subtitle that indicates findings"
author: "Report prepared for MINGAR by UofTears"
date: 2022-04-07
lang: "en"
output:
  pdf_document:
    template: report.tex
    toc: true
    toc_depth: 2
titlepage: true
titlepage-color: "002554"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
---

```{r load_packages, message = FALSE, echo=FALSE}
library(tidyverse)
library(lme4)
library(rvest)
library(polite)
library(lmtest)

# this should suppress all code and messages
knitr::opts_chunk$set(include=FALSE)
```

# General comments (you can delete this section)

_Before making any changes, knit this Rmd to PDF and change the name of the PDf to something like 'original-instructions.pdf', or whatever you like (it is just for your reference).. Then you can delete this section and if you want to check what it said, just open the other PDF. You don't HAVE to use this particular template, but you DO need to write you report in RMarkdown and include a cover page._

_The cover page must be a single stand alone page and have:_

*	_A title and subtitle (that indicate your findings)_
* _"Report prepared for MINGAR by" your company name_
*	_Date (assessment submission date is fine)_

_You can change the colour of this cover to any colour you would like by replacing 6C3082 in the YAML above (`titlepage-color:`) to another hex code. You could use this tool to help you:_ https://htmlcolorcodes.com/color-picker/

_Note: There should NOT be a table of contents on the cover page. It should look like a cover._

\newpage
# Executive summary

_Guidelines for the executive summary:_

* _No more than two pages_
* _Language is appropriate for a non-technical audience_
* _Bullet points are used where appropriate_
*	_A small number of key visualizations and/or tables are included_
*	_All research questions are addressed_


_The [module 4 writing prompt](https://sta303-bolton.github.io/sta303-w22-courseguide/knowledge-basket-writing-and-peer-feedback.html#module-4-writing-task) provides some tips and information about writing executive summaries._


\newpage
# Technical report
_This part of the report is much more comprehensive than the executive summary. The audience is statistics/data-minded people, but you should NOT include code or unformatted R output here._


## Introduction

_Provide a brief introduction to your report and outline what the report will cover. This section is valuable for setting scope and expectations. _

### Research questions
_Use bullet points to to describe the research questions you are going to address. Write in full sentences._

TO BE REPHRASED
- Who are our new customers? How are buyers of the newer and more affordable 'Active' and 'Advance' products different to our traditional customers? 
- Is there a difference in device performance for users of different skin color, particularly with respect to sleep scores?

## Informative title for section addressing research question 1

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

For research question 1, we used the cancensus API to retrieve 2016 median incomes for each census subdivision (defined by its unique CSDuid). Next, we downloaded 2016 Census Canada Postal Code Conversion Files from the University of Toronto portal- which indicates the CSDuid for various postcodes. Joining these datasets, we were able to determine median income for each postal code. After that, we joined this newly joined dataset with our customer data on postcode to evaluate an estimate of our customers' incomes. Note that there are customers with more than 1 postcode (and hence, are matched with more than 1 income). For such customers, we will assigned them the mean of the multiple incomes. Moreover, we add a new variable "age" to our customer data to inform us of the customer's current age. We now merge this customer information data with cust_dev on cust_id. This allows us to get information on customers and the specific ID of their device. Now, we merge this dataset with our device dataset on dev_id to retrieve information on each customer's device. Finally, we select the relevant variables such that our customer's sensitive data are not made public in our report.

## Research Question 2
To address research question 2, we first retrieved device data scraped from https://fitnesstrackerinfohub.netlify.app/, which gave us information on the device's name, line, retail price, and features. All data was scraped after confirming that we have permission from the website to do so. We also added a few potentially helpful variables to this dataset, including device retail price category and age based on its release date. Using the client provided data on device, we joined the two datasets to determine the device information corresponding to each device ID. From this, we selected only the devices that can track sleep, as sleep score is our main variable of interest. We then join this dataset with sleep data for each customer to match each sleep session to the associated device. From this, we selected only variables related to the investigation to protect customer privacy. Lastly, we dropped sessions with missing values for sex, pronouns, and/or postcode because there were not a lot to represent a significant trend, and they are not the predictors we wish to focus on for this question.

```{r load_data, echo=FALSE, warning=FALSE, message=FALSE}
# read in the data (this will only work once you've set up the data!)
cust_sleep_complete <- readRDS("data/cust_sleep_complete.Rds")

cust_sleep_complete <- cust_sleep_complete %>%
  mutate(emoji_modifier = 
           if_else(cust_sleep_complete$emoji_modifier=="U+1F3FB", "Light skin tone",
                   if_else(cust_sleep_complete$emoji_modifier=="U+1F3FC","Medium-Light skin tone",
                           if_else(cust_sleep_complete$emoji_modifier=="U+1F3FD","Medium skin tone",
                                   if_else(cust_sleep_complete$emoji_modifier=="U+1F3FE", 
                                           "Medium-Dark skin tone", if_else(
                                             cust_sleep_complete$emoji_modifier=="U+1F3FF",
                                  "Dark skin tone", cust_sleep_complete$emoji_modifier))))))

cust_sleep_complete <- cust_sleep_complete %>%
  mutate(emoji_modifier = if_else(is.na(cust_sleep_complete$emoji_modifier),
                                  "Default", cust_sleep_complete$emoji_modifier))
```

```{r, echo=FALSE, fig.cap="Barplots that show the distribution of the sleep quality for different number of flags and different emojis used."}
# create a visualization
cust_sleep_complete %>%
  mutate(flags=as.factor(flags)) %>%
  ggplot() +
  aes(y=duration, x=flags) +
  facet_wrap(~emoji_modifier) +
  geom_boxplot() +
  ylab("Duration of Sleep (in minutes)") +
  xlab("Number of flags") +
  ggtitle("Distribution of sleep quality")+
  coord_flip()
```

```{r, echo=FALSE}
device_performance_model <- lmer(flags ~ duration + emoji_modifier + (1|sex) + 
                                   (1|age), data=cust_sleep_complete)
```


## Informative title for section addressing a research question


## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

### Strengths and limitations

\newpage
# Consultant information
## Consultant profiles

*Complete this section with a brief bio for each member of your group. If you are completing the project individually, you only need to complete one for yourself. In that case, change the title of this section to 'Consultant profile' instead. Examples below. This section is only marked for completeness, clarity and professionalism, not 'truth' so you can write it as if we're a few years in the future. Put your current degree in as completed and/or add your first choice grad school program, whatever you like. What skills related skills would you most like to highlight? What job title do you want?*

**Chloe Nguyen**. Chloe is a third-year Data Science and Computer Science student at the University of Toronto. She specializes in data science and machine learning. Chloe has experience working in project management and software devlopment at Microsoft's Cloud and AI team- where she collaborated with internal and external stakeholders to create project plans, build prototypes and develop solutions. Chloe is an avid member of UofT's Computer Science community, having lead various student unions and clubs-such as President of Women in Computer Science, Treasurer of the Computer Science Student Union and Sponsorship Executive of Neurotech.

**Shih-Ting (Cindy) Huang**. Cindy is currently a third-year undergraduate studying Data Science at the University of Toronto. With a passion for improving user experience through machine learning, she actively seeks ways to implement different theoretical concepts in real life for business-oriented problems. Her skills in multidisciplinary fields, including data science, marketing, and linguistics, have enabled her to obtain a holistic perspective on multiple projects and devise creative solutions with a user-guided mindset.

**Warren Zhu**. Warren is a professional Data and Computer Scientist with over 10 years of experience. He was a former researcher at the University of Toronto, specializing in Multi-lingual Natural Language Processing. Having great understanding and experience with many Mathematical and Statistical concepts, he now serves as a consultant in various fields, including (but not limited to) marketing, health care and linguistics.

**Xiaotang (Jeffrey) Zhou**. Some bio stuff here.

## Code of ethical conduct

_This section should be fairly short, no more than half a page. Assume a general audience, much like your executive summary._

The UofTears team is committed to abiding by ethical guidelines for statistical practice when preparing and analyzing data. We promise to avoid disclosing confidential information without prior permission from our clients, such as data on their customers and devices. Moreover, we seek to make careful conclusions about the data and the investigative questions at hand. In this report, we have listed out all the assumptions we made when constructing the models as well as potential limitations to our research, fully informing the audience of the context surrounding our conclusions. Lastly, we hold responsibility to the society. The goal of this investigation was not only to determine if products could have harmful biases towards certain populations, but also assist the general public in understanding easily how we have obtained those insights.

1. Responsibility to Society: "strive to advance public knowledge and understanding of information...providing assistance in discrediting false or misleading info"
2. Responsibility to Employers and Clients: avoid disclosure of confidential information without prior written permission
3. Prevent use of misleading summary of the data and ensure to detail all assumptions and limitations relevant to the data

* _Make at least three relevant statements about your company's approach to ethical statistical consulting. These should be appropriately in line with professional conduct advice like the (Statistical Society of Canada Code of Conduct)[https://ssc.ca/sites/default/files/data/Members/public/Accreditation/ethics_e.pdf] or the (Ethical Guidelines for Statistical Practice from the American Statistical Society)[https://www.amstat.org/ASA/Your-Career/Ethical-Guidelines-for-Statistical-Practice.aspx]. For example, "the customer is always right" ISN'T the type of thing an ethical statistical consultant would include._
*	_Be very careful not to just copy and paste from these other documents! Put things in your own words._


\newpage
# References

_You don't need to cite course materials, but consider all the the places you got data from, as well as the packages used and R itself. These are all things you should consider citing. Likewise, you might use some external resources on the emoji skin tones/Fitzpatrick scale, etc._
Achim Zeileis, Torsten Hothorn (2002). Diagnostic Checking in Regression
  Relationships. R News 2(3), 7-10. URL https://CRAN.R-project.org/doc/Rnews/

Dmytro Perepolkin (2019). polite: Be Nice on the Web. R package version 0.1.1.
  https://CRAN.R-project.org/package=polite
  
Douglas Bates, Martin Maechler, Ben Bolker, Steve Walker (2015). Fitting Linear
  Mixed-Effects Models Using lme4. Journal of Statistical Software, 67(1), 1-48.
  doi:10.18637/jss.v067.i01.

Fitness tracker info hub. (n.d.). Retrieved April 3, 2022, 
  from https://fitnesstrackerinfohub.netlify.app/. 

Hadley Wickham (2021). rvest: Easily Harvest (Scrape) Web Pages. R package
  version 1.0.2. https://CRAN.R-project.org/package=rvest
  
Postal code conversion file. (2016). Toronto. Retrieved April 3, 2022, 
  from https://mdl.library.utoronto.ca/collections/numeric-data/census-canada/postal-code-conversion-file. 

R Core Team (2021). R: A language and environment for statistical computing. R
  Foundation for Statistical Computing, Vienna, Austria. URL
  https://www.R-project.org/.

Unicode, Inc. (n.d.). Full Emoji Modifier Sequences, v14.0. Unicode, Inc. 
  Retrieved April 4, 2022, from 
  https://unicode.org/emoji/charts/full-emoji-modifiers.html. 

von Bergmann, J., &amp; Cervantes, A. (2022, February 9). Population Density by 
  CensusMapper. Census Mapper. map. Retrieved April 3, 2022, 
  from https://censusmapper.ca/. 

Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source
  Software, 4(43), 1686, https://doi.org/10.21105/joss.01686

\newpage
# Appendix

_These appendices should outline in more detail the steps taken to access the following datasets. They should NOT include code, but should briefly describe the steps and important considerations. I.e., show that you understand what needs to be considered when web scraping, protecting licensed data, etc._

## Web scraping industry data on fitness tracker devices

## Accessing Census data on median household income

## Accessing postcode conversion files


__Final advice: KNIT EARLY AND OFTEN!__
